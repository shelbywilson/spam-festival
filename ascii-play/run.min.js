var e={preferredElementNodeName:"PRE",render:function(e,s){const i=e.settings.element;e.rows==o&&e.cols==n||(n=e.cols,o=e.rows,t.length=0);for(;i.childElementCount<o;){const e=document.createElement("span");e.style.display="block",i.appendChild(e)}for(;i.childElementCount>o;)i.removeChild(i.lastChild);for(let c=0;c<o;c++){const o=c*n;let a=!1;for(let e=0;e<n;e++){const n=e+o,l=s[n];r(l,t[n])||(a=!0,t[n]={...l})}if(0==a)continue;let d="",f={},h=!1;for(let t=0;t<n;t++){const n=s[t+o];if(n.beginHTML&&(h&&(d+="</span>",f={},h=!1),d+=n.beginHTML),!l(n,f)){h&&(d+="</span>");const t=n.color===e.settings.color?null:n.color,o=n.backgroundColor===e.settings.backgroundColor?null:n.backgroundColor,r=n.fontWeight===e.settings.fontWeight?null:n.fontWeight;let l="";t&&(l+="color:"+t+";"),o&&(l+="background:"+o+";"),r&&(l+="font-weight:"+r+";"),l&&(l=' style="'+l+'"'),d+="<span"+l+">",h=!0}d+=n.char,f=n,n.endHTML&&(h&&(d+="</span>",f={},h=!1),d+=n.endHTML)}h&&(d+="</span>"),i.childNodes[c].innerHTML=d}}};const t=[];let n,o;function r(e,t){return"object"==typeof e&&("object"==typeof t&&(e.char===t.char&&(e.fontWeight===t.fontWeight&&(e.color===t.color&&e.backgroundColor===t.backgroundColor))))}function l(e,t){return e.fontWeight===t.fontWeight&&(e.color===t.color&&e.backgroundColor===t.backgroundColor)}var s={preferredElementNodeName:"CANVAS",render:function(e,t){const n=e.settings.element,o=devicePixelRatio,r=e.cols,l=e.rows,s=e.metrics,i=s.cellWidth,c=Math.round(s.lineHeight),a=e.settings;a.canvasSize?(n.width=a.canvasSize.width*o,n.height=a.canvasSize.height*o,n.style.width=a.canvasSize.width+"px",n.style.height=a.canvasSize.height+"px"):(n.width=e.width*o,n.height=e.height*o);const d=" "+s.fontSize+"px "+s.fontFamily,f=a&&a.backgroundColor?a.backgroundColor:"white",h=a&&a.color?a.color:"black",u=a&&a.fontWeight?a.color:"400",p=n.getContext("2d");if(p.fillStyle=f,p.fillRect(0,0,n.width,n.height),p.save(),p.scale(o,o),p.fillStyle=h,p.textBaseline="top",a.canvasOffset){const e=a.canvasOffset,t=Math.round("auto"==e.x?(n.width/o-r*i)/2:e.x),s=Math.round("auto"==e.y?(n.height/o-l*c)/2:e.y);p.translate(t,s)}if("center"==a.textAlign)for(let e=0;e<l;e++){const l=e*r,s=[];let i=0;for(let e=0;e<r;e++){const n=t[l+e];p.font=(n.fontWeight||u)+d;const o=p.measureText(n.char).width;i+=o,s[e]=o}let a=.5*(n.width/o-i);const m=e*c;for(let e=0;e<r;e++){const n=t[l+e],o=a;n.backgroundColor&&n.backgroundColor!=f&&(p.fillStyle=n.backgroundColor||f,p.fillRect(Math.round(o),m,Math.ceil(s[e]),c)),p.font=(n.fontWeight||u)+d,p.fillStyle=n.color||h,p.fillText(n.char,a,m),a+=s[e]}}else for(let e=0;e<l;e++)for(let n=0;n<r;n++){const o=t[e*r+n],l=n*i,s=e*c;o.backgroundColor&&o.backgroundColor!=f&&(p.fillStyle=o.backgroundColor||f,p.fillRect(Math.round(l),s,Math.ceil(i),c)),p.font=(o.fontWeight||u)+d,p.fillStyle=o.color||h,p.fillText(o.char,l,s)}p.restore()}};class i{constructor(){this.frames=0,this.ptime=0,this.fps=0}update(e){return this.frames++,e>=this.ptime+1e3&&(this.fps=1e3*this.frames/(e-this.ptime),this.ptime=e,this.frames=0),this.fps}}var c=function(e,t){try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return!1}},a=function(e,t={}){const n=JSON.parse(localStorage.getItem(e));return Object.assign(t,n),t},d="1.1";const f={canvas:s,text:e},h={element:null,cols:0,rows:0,once:!1,fps:30,renderer:"text",allowSelect:!1,restoreState:!1},u=["backgroundColor","color","fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","textAlign"];function p(e,t,n={}){return new Promise(function(o){const r={...h,...t,...e.settings},l={time:0,frame:0,cycle:0},s="currentState";let d;r.restoreState&&(a(s,l),l.cycle++),r.element?"canvas"==r.renderer?"CANVAS"==r.element.nodeName?d=f[r.renderer]:console.warn("This renderer expects a canvas target element."):"CANVAS"!=r.element.nodeName?d=f[r.renderer]:console.warn("This renderer expects a text target element."):(d=f[r.renderer]||f.text,r.element=document.createElement(d.preferredElementNodeName),document.body.appendChild(r.element));for(const e of u)r[e]&&(r.element.style[e]=r[e]);const p=[],m={x:0,y:0,pressed:!1,px:0,py:0,ppressed:!1};r.element.addEventListener("pointermove",e=>{const t=r.element.getBoundingClientRect();m.x=e.clientX-t.left,m.y=e.clientY-t.top,p.push("pointerMove")}),r.element.addEventListener("pointerdown",e=>{m.pressed=!0,p.push("pointerDown")}),r.element.addEventListener("pointerup",e=>{m.pressed=!1,p.push("pointerUp")});const w=e=>{const t=r.element.getBoundingClientRect();m.x=e.touches[0].clientX-t.left,m.y=e.touches[0].clientY-t.top,p.push("pointerMove")};r.element.addEventListener("touchmove",w),r.element.addEventListener("touchstart",w),r.element.addEventListener("touchend",w),r.element.style.fontStrech="normal",r.allowSelect||y(r.element),document.fonts.ready.then(t=>{let o=3;!function t(){--o>0?requestAnimationFrame(t):function(){k=b(r.element);const t=g(l,r,k,C);"function"==typeof e.boot&&e.boot(t,v,n);requestAnimationFrame(R)}()}()});const C=new i,S=" ",x=Object.freeze({color:r.color,backgroundColor:r.backgroundColor,fontWeight:r.fontWeight}),v=[];let k;let E=0;const N=1e3/r.fps,M=l.time;let W,A;function R(t){const i=t-E;if(i<N)return void(r.once||requestAnimationFrame(R));const a=g(l,r,k,C);C.update(t),E=t-i%N,l.time=t+M,l.frame++,c(s,l);const f={x:Math.min(a.cols-1,m.x/k.cellWidth),y:Math.min(a.rows-1,m.y/k.lineHeight),pressed:m.pressed,p:{x:m.px/k.cellWidth,y:m.py/k.lineHeight,pressed:m.ppressed}};if(m.px=m.x,m.py=m.y,m.ppressed=m.pressed,W!=a.cols||A!=a.rows){W=a.cols,A=a.rows,v.length=a.cols*a.rows;for(let e=0;e<v.length;e++)v[e]={...x,char:S}}if("function"==typeof e.pre&&e.pre(a,f,v,n),"function"==typeof e.main)for(let t=0;t<a.rows;t++){const o=t*a.cols;for(let r=0;r<a.cols;r++){const l=r+o,s=e.main({x:r,y:t,index:l},a,f,v,n);v[l]="object"==typeof s&&null!==s?{...v[l],...s}:{...v[l],char:s},Boolean(v[l].char)||0===v[l].char||(v[l].char=S)}}for("function"==typeof e.post&&e.post(a,f,v,n),d.render(a,v,r);p.length>0;){const t=p.shift();t&&"function"==typeof e[t]&&e[t](a,f,v)}r.once||requestAnimationFrame(R),o(a)}})}function g(e,t,n,o){const r=t.element.getBoundingClientRect(),l=t.cols||Math.floor(r.width/n.cellWidth),s=t.rows||Math.floor(r.height/n.lineHeight);return Object.freeze({frame:e.frame,time:e.time,cols:l,rows:s,metrics:n,width:r.width,height:r.height,settings:t,runtime:Object.freeze({cycle:e.cycle,fps:o.fps})})}function y(e){e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.mozUserSelect="none",e.dataset.selectionEnabled="false"}function w(e){const t="false"==!e.dataset.selectionEnabled;t||function(e){e.style.userSelect="auto",e.style.webkitUserSelect="auto",e.style.mozUserSelect="auto",e.dataset.selectionEnabled="true"}(e);const n=document.createRange();n.selectNode(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n),document.execCommand("copy"),o.removeAllRanges(),t||y(e)}function b(e){const t=getComputedStyle(e),n=t.getPropertyValue("font-family"),o=parseFloat(t.getPropertyValue("font-size")),r=parseFloat(t.getPropertyValue("line-height"));let l;if("CANVAS"==e.nodeName){const t=e.getContext("2d");t.font=o+"px "+n,l=t.measureText("".padEnd(50,"X")).width/50}else{const t=document.createElement("span");e.appendChild(t),t.innerHTML="".padEnd(50,"X"),l=t.getBoundingClientRect().width/50,e.removeChild(t)}return{aspect:l/r,cellWidth:l,lineHeight:r,fontFamily:n,fontSize:o,_update:function(){const t=b(e);for(var n in t)"number"!=typeof t[n]&&"string"!=typeof t[n]||(m[n]=t[n])}}}export{d as RUNNER_VERSION,b as calcMetrics,w as copyContent,p as run};
